const o={section:".js-products-bundle",button:".js-products-bundle-button",cardButton:".js-product-card-button",hiddenInput:".js-product-card-variant-input",formError:".js-product-card-error",error:".js-product-bundle-error",total:".js-product-total",totalPrice:".js-product-total-price",amount:"[data-amount]",card:".js-product-card",isCurrencyEnabled:"[data-currency-code-enabled]"},E={amount:"data-amount"},h=()=>{let u,i;async function f(t){u=[...document.querySelectorAll(o.section)].filter(r=>!t||r.closest(`#shopify-section-${t}`)),u.forEach(r=>l(r))}function l(t){if(!t)return;const n=t.querySelector(o.isCurrencyEnabled)?window.themeCore.objects.shop.money_with_currency_format:window.themeCore.objects.shop.money_format;i=s=>window.themeCore.utils.formatMoney(s,n);const e=t.dataset.section,d=t.querySelector(o.button);if(!d)return;const c={preOrder:window.themeCore.translations.get("products.product.pre_order"),enabled:d.dataset.enabledLabel,disabled:d.dataset.disabledLabel};window.themeCore.EventBus.listen("product-card:change-variant",s=>C({event:s,section:t,sectionId:e,button:d,buttonLabels:c})),t.addEventListener("click",A),p(t)}function C({event:t,section:r,sectionId:n,button:e,buttonLabels:d}){if(t.sectionId!==n)return;const c=[...r.querySelectorAll(o.card)],s=[...r.querySelectorAll(o.hiddenInput)],m=[...r.querySelectorAll(o.formError)],w=s.every(a=>a.value)&&m.every(a=>a.innerText!==window.themeCore.translations.get("products.product.sold_out")),v=s.every(a=>a.value)&&m.every((a,g)=>a.innerText===""?c[g].hasAttribute("data-preorder"):a.innerText===window.themeCore.translations.get("products.product.pre_order"));e.disabled=!w,v?e.innerHTML=d.preOrder:w?e.innerHTML=d.enabled:e.innerHTML=d.disabled,p(r)}function p(t){const r=t.querySelector(o.total),n=t.querySelector(o.totalPrice),e=b(t);!r||!n||(r.classList.toggle(window.themeCore.utils.cssClasses.active,e!==null),e!==null&&(n.innerText=i(e)))}function b(t){const n=[...t.querySelectorAll(o.card)].map(e=>{const d=e.querySelector(o.amount),c=e.querySelector(o.hiddenInput);return!d||!c||!c.getAttribute("value")?null:d.getAttribute(E.amount)||null});return n.includes(null)?null:n.reduce((e,d)=>e+=+d,0)}async function A(t){const r=t.target.closest(o.button);if(!r)return;const n=r.closest(o.section);if(!n)return;const e=n.querySelector(o.error),d=[...n.querySelectorAll(o.hiddenInput)],c=await q(d);e&&(e.innerHTML=c),!c&&window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.GET_CART)}async function q(t){try{return await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART_MANY,t.map(r=>{const n=r.closest(o.card),e={id:r.value,quantity:1};return n&&n.hasAttribute("data-preorder")&&(e.properties=e.properties||{},e.properties["_Pre-order"]="true"),e})),""}catch(r){return r.description}}return Object.freeze({init:f,initSection:l})},y=()=>{window.themeCore.ProductsBundle=window.themeCore.ProductsBundle||h(),window.themeCore.utils.register(window.themeCore.ProductsBundle,"products-bundle"),window.themeCore.utils.registerExternalUtil(h,"products-bundle")};window.themeCore&&window.themeCore.loaded?y():document.addEventListener("theme:all:loaded",y,{once:!0});
