const o={section:".js-product-recommendations",content:".js-product-recommendations-content",recommendations:"[data-product-recommendations]",recommendationsItems:".js-product-recommendations-col",recommendationsRowWrapper:".js-product-recommendations-row-wrapper",viewedLabel:".js-product-recommendations-viewed-label",viewedContent:".js-product-recommendations-viewed-content",productCard:".js-product-card",tabsButton:".js-product-recommendations-tab-button",tabsContent:".js-product-recommendations-tab-content",buttonsWrapper:".js-product-recommendations--buttons-wrapper",existingProduct:"[data-existing-product]"},E={id:"id"},p={section:"section_id",limit:"limit",product:"product_id",view:"view"},j=()=>{let b=window.themeCore.utils.Swiper,w=[];const d={featuredContentSlider:"js-featured-content-slider",tabs:"is-tabs",...window.themeCore.utils.cssClasses};async function g(e){w=C(e),await Promise.all(w.map(t=>S(t))),window.themeCore.LazyLoadImages.init(),w.forEach(t=>{const r=t.el.querySelector(o.recommendationsRowWrapper);r&&y(t,r)})}function y(e,t){const r=[...t.querySelectorAll(o.recommendationsItems)].length,n=e.layout==="alternative"?4:3;let s={grabCursor:!0,slidesPerView:1.1618,on:{init(){e.el.classList.remove(d.loading)}}};r>n?(s.navigation={nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},s.breakpoints={768:{slidesPerView:n}}):s.breakpoints={768:{slidesPerView:n,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}},new b(t,s)}function C(e){return[...document.querySelectorAll(o.section)].filter(t=>!e||t.closest(`#shopify-section-${e}`)).map(t=>{const r=t.getAttribute(E.id),n=window.themeCore.objects.routes.product_recommendations_url,s=t.dataset.productId,i=t.dataset.limit,l=t.dataset.layout,a=!!t.closest(o.recommendations);return{el:t,id:r,requestUrl:n,product:s,limit:i,enableRecommendations:a,layout:l}})}async function S(e){if(!e.enableRecommendations){if(!e.limit)return Promise.resolve();let t=e.el.querySelector(o.content);return await h(t,e),Promise.resolve()}try{const t=new URL(window.location.origin+e.requestUrl);t.searchParams.set(p.section,e.id),t.searchParams.set(p.product,e.product),t.searchParams.set(p.limit,e.limit),await fetch(t.toString()).then(r=>r.text()).then(async r=>{const n=document.createElement("div");n.innerHTML=r;const s=e.el.querySelector(o.content);let i=n.querySelector(o.content);const l=[...i.querySelectorAll(o.recommendationsItems)],a=i.querySelector(o.recommendationsRowWrapper);if(e.limit)i=await h(i,e);else if(!!!i.querySelector(o.existingProduct)){e.el.remove();return}i&&i.innerHTML.trim().length&&(s.innerHTML=i.innerHTML),l&&l.length&&a&&a.classList.add(d.featuredContentSlider),window.themeCore.EventBus.emit("compare-products:init")}).catch(r=>{console.error(r)})}catch(t){console.error(t)}}async function h(e,t){if(!e)return;let r=localStorage.getItem("theme_recently_viewed");const n=!!e.querySelector(o.existingProduct);if(!r)return n||t.el.remove(),e;try{if(r=JSON.parse(r),window.location.href.includes("/products/")){const c=new URL(window.location.href).pathname,m=(c.startsWith("/")?c.substring(1):c).split("/").pop();r=r.filter(u=>u!==m)}if(r=r.slice(-1*+t.limit),!r.length)return n||t.el.remove(),e;const s=(await L(r)).map(a=>a.value).filter(Boolean).slice(-1*+t.limit);if(!s.length)return n||t.el.remove(),e;const i=s.map(a=>q(a,t)),l=e.querySelector(o.viewedContent);if(l){l.innerHTML=i.reduce((u,x)=>u+=x.outerHTML,"");const a=t.el.querySelector(o.viewedLabel);if(!a)return e;if(n)return a.classList.remove(d.hidden),s.length&&(t.el.classList.add(d.tabs),R(t)),e;const c=[...e.querySelectorAll(o.recommendationsRowWrapper)].find(u=>+u.dataset.index==1);c&&c.classList.add(d.hidden);const f=[...t.el.querySelectorAll(o.tabsButton)].find(u=>+u.dataset.index==1);f&&f.remove();const m=[...e.querySelectorAll(o.recommendationsRowWrapper)].find(u=>+u.dataset.index==2);return m&&m.classList.add(d.active),a.classList.remove(d.hidden),e}}catch(s){return console.log(s),e}return e}async function L(e){return await Promise.allSettled(e.map(t=>P(t)))}async function P(e){let t=new URL(`${window.location.origin}${window.themeCore.objects.routes.root_url}/products/${e}`);return t.searchParams.set(p.view,"card"),await fetch(t.toString()).then(r=>r.ok?r.text():!1).then(r=>{if(!r)return!1;const n=document.createElement("div");return n.innerHTML=r,n.querySelector(o.productCard)?n.querySelector(o.productCard):!1}).catch(r=>{console.error(r)})}function q(e,t){const r=document.createElement("div");return r.innerHTML=`
			<div class="product-recommendations__col swiper-slide product-recommendations__col--${t.layout}">
				${e.outerHTML}
			</div>
		`,r.querySelector(".product-recommendations__col")}function R(e){!e||!e.el||e.el.addEventListener("click",t=>{const r=t.target.closest(o.tabsButton);if(!r)return;const n=r.dataset.index,s=[...e.el.querySelectorAll(o.tabsButton)],i=[...e.el.querySelectorAll(o.tabsContent)],l=e.el.querySelector(o.buttonsWrapper);if(!n||!s.length||!i.length||!l)return;s.forEach(c=>c.classList.toggle(d.active,c===r)),i.forEach(c=>c.classList.toggle(d.active,c.dataset.index===n));const a=r.offsetLeft;l.scrollTo({left:a,behavior:"smooth"})})}return Object.freeze({init:g})},v=()=>{window.themeCore.ProductRecommendations=window.themeCore.ProductRecommendations||j(),window.themeCore.utils.register(window.themeCore.ProductRecommendations,"product-recommendations")};window.themeCore&&window.themeCore.loaded?v():document.addEventListener("theme:all:loaded",v,{once:!0});
