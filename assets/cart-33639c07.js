const ye=()=>{const H=window.themeCore.utils.Toggle,u=window.themeCore.utils.cssClasses,P=window.themeCore.utils.formToJSON,B=window.themeCore.utils.on,J=window.themeCore.utils.QuantityWidget,Q=window.themeCore.utils.CartUpsell,k=window.themeCore.utils.Preloder,x=Shopify.currency.rate||1,I=window.themeCore.objects.shop.money_format,W=window.themeCore.Accordion,n={section:'[data-section-type="cart-template"]',sectionDrawer:'[data-section-modification="drawer"]',upsellDrawer:"#CartUpsellDrawer",subtotal:".js-cart-subtotal",container:".js-cart-container",content:".js-cart-content",termsAndConditionsCheckbox:".js-terms-and-conditions-checkbox",buttonsContent:".js-cart-footer-button",cartButton:".js-cart-button",additionalButtons:".js-cart-footer-additional-buttons",cartItem:"[data-cart-item]",quantity:".js-quantity",quantityError:".js-cart-item-error-message",remove:".js-cart-item-remove",closeButton:".js-cart-close-button",cartNoteField:".js-cart-notes-field",cartDrawerNoteControlText:".js-cart-note-control-text",cartFooterButtonMessage:".js-cart-footer-button-message",submit:'[type="submit"]',scrollable:"[data-scrollable]",upsellMobileTrigger:".js-cart-upsell-trigger",cartEmptySlider:".js-cart-empty-slider",cartEmptyButtonPrev:".js-cart-empty-button-prev",cartEmptyButtonNext:".js-cart-empty-button-next",discount:".js-cart-discount-block",discountAccordionContainer:".js-cart-discount-accordion-container",accordionItem:".js-accordion-item",accordionControl:".js-accordion-control",discountForm:".js-cart-discount-form",discountApply:".js-cart-discount-apply-button",discountPill:".js-cart-discount-pill",discountRemove:".js-cart-discount-pill-remove",discountError:".js-cart-discount-error",discountErrorCode:".js-cart-discount-error-code",discountErrorShipping:".js-cart-discount-error-shipping"},h={...u,empty:"is-empty"};let S=[],j=[];function G(){$(),K(),O(),Z(),N(),window.themeCore.objects.settings.show_shipping_rates_calculator&&window.Shopify&&he()}let M=!1;function $(){const e=window.themeCore.utils.Swiper,o=document.querySelector(n.cartEmptySlider);o&&new e(o,{slidesPerView:2,spaceBetween:16,navigation:{nextEl:n.cartEmptyButtonNext,prevEl:n.cartEmptyButtonPrev},breakpoints:{768:{slidesPerView:1.85}}})}function N(){const e=document.querySelector(n.termsAndConditionsCheckbox),o=document.querySelector(n.cartButton),t=document.querySelector(n.cartFooterButtonMessage);!e||t&&t.classList.contains(u.disabled)||(o.disabled=!e.checked,e.addEventListener("change",()=>{o.disabled=!e.checked}))}function K(){j=[...document.querySelectorAll(n.sectionDrawer)].map(e=>{const o=H({toggleSelector:e.id,closeAccordionsOnHide:!1});o.init();const t={el:e,toggle:{open:()=>o.open(e),close:()=>o.close(e)}};return Y(t),t})}function Y(e){!e||!e.toggle||(window.themeCore.EventBus.listen(`cart:drawer:${e.el.id}:open`,e.toggle.open),window.themeCore.EventBus.listen(`cart:drawer:${e.el.id}:close`,e.toggle.close))}function O(){S=Array.from(document.querySelectorAll(n.section)).map(e=>({el:e,id:e.dataset.sectionId,content:e.querySelector(n.content)})),S.forEach(e=>{const o=Array.from(e.el.querySelectorAll(n.quantity));!o||!o.length?e.quantityWidgets=[]:e.quantityWidgets=o.map(a=>J(a,{onQuantityChange:se}).init());const t=k(e.el);t&&(e.preloader=t.init()),e.upsell={};const r=e.el.querySelector(n.upsellDrawer),c=Q(r,{onFormSubmit:ue});if(c&&r){e.upsell=c.init();const a=e.el.querySelector(n.upsellMobileTrigger);a&&a.replaceWith(a.cloneNode(!0)),e.upsell.drawer=H({toggleSelector:e.upsell.container.id,closeAccordionsOnHide:!1,overlay:!1}),e.upsell.drawer.init();const l=k(e.upsell.container);l&&(e.upsell.preloader=l.init()),window.themeCore.EventBus.listen(`Toggle:${e.el.id}:close`,function(){e.upsell.drawer.close(e.upsell.container)})}B("click",e.el,ie),B("submit",e.el,ae),B("click",e.el,le)}),fe(),ge(),window.themeCore.LazyLoadImages.init()}function Z(){window.themeCore.EventBus.listen("cart:updated",pe),window.themeCore.EventBus.listen("cart:refresh",D),window.themeCore.EventBus.listen("cart:drawer:open",R),window.themeCore.EventBus.listen("cart:drawer:refresh-and-open",te),window.themeCore.EventBus.listen("cart:drawer:close",oe),document.addEventListener("click",e=>e.target.closest(n.closeButton)&&window.themeCore.EventBus.emit("cart:drawer:close")),document.addEventListener("change",X)}async function X(e){const o=e.target.closest(n.cartNoteField),t=document.querySelector(n.cartDrawerNoteControlText);if(o){A();try{await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.UPDATE_CART,{note:o.value})}catch(r){console.log(r)}finally{q(),t&&(o.value!==""?t.textContent=window.themeCore.translations.get("cart.general.edit_note"):t.textContent=window.themeCore.translations.get("cart.general.note"))}}}function T(){return S.map(e=>e.id)}async function ee(){const e=T(),o=new URL(window.location.href);return o.searchParams.set("sections",e.join(",")),o.searchParams.set("lazyload","false"),fetch(o.href).then(t=>t.json())}function R(e){if(e&&e.id){window.themeCore.EventBus.emit(`cart:drawer:${e.id}:open`);return}const o=j.find(t=>t.toggle&&t.toggle.open);o&&o.toggle.open()}function te(e){D().then(()=>{R(e)})}function oe(e){if(e&&e.id){window.themeCore.EventBus.emit(`cart:drawer:${e.id}:close`);return}j.forEach(o=>{o.toggle&&o.toggle.close&&o.toggle.close()})}function A(){S.forEach(e=>{e.preloader&&e.preloader.show(),e.upsell&&e.upsell.preloader&&e.upsell.preloader.show()})}function q(){S.forEach(e=>{e.preloader&&e.preloader.hide(),e.upsell&&e.upsell.preloader&&e.upsell.preloader.hide()})}async function D(e=null){const o=e&&Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype?e:await ee();if(!o)return!1;S.map(t=>{const r=new DOMParser().parseFromString(o[t.id],"text/html"),c=r.querySelector(n.section),a=r.querySelector(n.content),l=r.querySelector(n.subtotal),d=r.querySelector(n.buttonsContent),s=r.querySelector(n.additionalButtons),p=r.querySelector(n.cartFooterButtonMessage),m=r.querySelector(n.upsellDrawer),g=r.querySelector(n.discount);let w=!1;const f=t.el.querySelector(n.discountAccordionContainer);if(f){const i=f.querySelector(n.accordionItem);i&&(w=i.classList.contains(h.active))}if(!c||!a)return;t.el.classList.toggle(h.empty,c.classList.contains(h.empty));const E=t.el.querySelector(n.content);if(!E)return;if(d){const i=t.el.querySelector(n.buttonsContent);i&&i.innerHTML!==d.innerHTML&&(i.innerHTML=d.innerHTML)}if(p){const i=t.el.querySelector(n.cartFooterButtonMessage);i&&i.outerHTML!==p.outerHTML&&(i.outerHTML=p.outerHTML)}if(s){const i=t.el.querySelector(n.additionalButtons);i&&i.innerHTML!==s.innerHTML&&i.classList.toggle(h.hidden,s.classList.contains(h.hidden))}if(l){const i=t.el.querySelector(n.subtotal);i&&(i.innerHTML=l.innerHTML)}if(g){const i=t.el.querySelector(n.discount);if(i&&(i.innerHTML=g.innerHTML),w){const C=i.querySelector(n.discountAccordionContainer);if(C){const b=C.querySelector(n.accordionItem);b.classList.add(u.active),b.querySelector(n.accordionControl).setAttribute("aria-expanded",!0)}}W.init()}const y=t.el.querySelector(n.upsellMobileTrigger);if(y&&y.classList.toggle(h.hidden,!m),!m&&t.upsell.container)t.upsell.container.outerHTML="",t.upsell.container.remove();else if(m)if(t.upsell.container){const i=t.upsell.container.querySelector(n.scrollable),C=i?i.scrollTop:0,b=t.upsell.refresh(m);if(b){t.upsell.container.innerHTML=b;const L=t.upsell.container.querySelector(n.scrollable);L&&L.scrollTo({top:C})}else t.upsell.container.outerHTML="",t.upsell.container.remove()}else t.el.insertAdjacentHTML("beforeend",m.outerHTML);E.innerHTML=a.innerHTML}),O(),$(),N()}function re(e,o){window.themeCore.EventBus.emit("product-card:quick-view:clicked",{productHandle:e,variant:o})}async function ne(e,o,t){try{const r={id:e,quantity:o};t&&t.getAttribute("data-preorder")==="true"&&(r.properties=r.properties||{},r.properties["_Pre-order"]="true"),await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART,r),await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.GET_CART)}catch(r){return r&&r.description}}function se(e){if(!e||!e.controls||!e.controls.input)return;A();const t=e.controls.input.dataset.itemKey,r=e.quantity.value,c=T().join(",");window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.CHANGE_CART_ITEM_QUANTITY,t,r,c).then(async a=>{let l=a.items.find(d=>d.key===t);if(l&&r!==l.quantity){const d=window.themeCore.translations.get("cart.errors.quantity",{count:l.quantity,title:l.title});throw M=!0,setTimeout(()=>{M=!1},0),{description:d}}}).catch(a=>{de(e,a)}).finally(()=>{q()})}function ie(e){const o=e.target.closest(n.remove);if(!o)return;e.preventDefault(),A();const t=T().join(","),r=o.dataset.itemKey;window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.REMOVE_CART_ITEM,r,t).finally(()=>{q()})}function F(){return[...document.querySelectorAll(n.discountPill)].map(o=>o.dataset.discountCode)}function ce(e){const o=[];return(e.cart_level_discount_applications||[]).forEach(t=>{const r=t.discount_application??t;r.type==="discount_code"&&o.push(r.title)}),(e.items||[]).forEach(t=>{(t.line_level_discount_allocations||[]).forEach(r=>{const c=r.discount_application??r;c.type==="discount_code"&&o.push(c.title)})}),[...new Set(o)]}async function ae(e){const o=e.target.closest(n.discountForm);if(o){e.preventDefault(),e.stopPropagation(),A();try{const r=P(o).discount,c=F();if(c.includes(r))return;const a=T().join(",");await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.UPDATE_CART,{discount:[...c,r].join(",")},a),o.reset()}catch(t){console.log("Error while submit discount:",t)}finally{q()}}}function U(e){const o=document.querySelector(n.discountError),t=document.querySelector(n.discountErrorCode),r=document.querySelector(n.discountErrorShipping);o.classList.remove(u.hidden),e==="discount_code"?(t.classList.remove(u.hidden),r.classList.add(u.hidden)):e==="shipping_error"&&(t.classList.add(u.hidden),r.classList.remove(u.hidden))}async function le(e){if(!e.target.closest(n.discountRemove))return;const t=e.target.closest(n.discountPill);if(!t)return;const r=t.dataset.discountCode;if(r){A();try{const c=F(),a=c.indexOf(r);if(a===-1)return;c.splice(a,1);const l=T().join(",");await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.UPDATE_CART,{discount:c.join(",")},l)}catch(c){console.log("Error while removing discount:",c)}finally{q()}}}function de(e,o){if(!e||!o)return;e.rollbackValue();const t=e.widget.closest(n.cartItem);if(!t)return;const r=t.querySelector(n.quantityError);r.innerHTML=o.message||o.description}function ue(e){const o=e.target;if(!o)return;e.preventDefault();const t=P(o),{id:r,handle:c,singleVariant:a,quantity:l}=t;if(!JSON.parse(a)){re(c,r);return}A();const d=o.querySelector(n.submit);d&&d.classList.add(h.loading),ne(r,Number(l),o).then(()=>{d&&d.classList.remove(h.loading),window.themeCore.EventBus.emit("Toggle:CartUpsellDrawer:close"),q()})}function pe(e){let o=null;e&&(o=e.sections),M||D(o).then(()=>{me(e);const t=window.themeCore.objects.settings.show_cart_notification,r=!e.params.some(c=>c.noOpen);!JSON.parse(t)&&r&&window.themeCore.EventBus.emit("cart:drawer:open")})}function me(e){const o=e.params.find(s=>s&&typeof s=="object"&&"discount"in s);if(!o)return;const t=o.discount.split(",").at(-1),r=e.discount_codes;if(r.find(s=>s.code===t&&!s.applicable)){U("discount_code");return}const a=ce(e);!r.filter(s=>s.applicable).map(s=>s.code).every(s=>a.includes(s))&&U("shipping_error")}function fe(){let e=document.querySelector(".js-cart-shipping");if(!e)return;let o=Number(e.getAttribute("data-cart-total")),t=e.getAttribute("data-amount-cents")*x,r=o/t*100,c=e.getAttribute("data-amount-message"),a=e.getAttribute("data-success-message"),l=e.querySelector(".js-cart-shipping-progress-bar"),d=e.querySelector(".js-cart-shipping-amount-msg"),s=e.querySelector(".js-cart-shipping-icon"),p=e.querySelector(".js-shipping-bar-progress-hidden-text"),m=window.themeCore.translations.get("cart.shipping_bar.progress").replace("{{ value }}",r.toFixed(1));if(e.style.setProperty("--shipping-bar-progress-value",r+"%"),p&&(p.textContent=m),r<100){let g=t-o,w=window.themeCore.utils.formatMoney(g,I),f=c.replace("{amount}",`<strong>${w}</strong>`);d.innerHTML=f,l.classList.remove(u.hidden),s&&s.classList.add(u.hidden)}else d.innerHTML=a,l.classList.add(u.hidden),s&&s.classList.remove(u.hidden)}function ge(){const e=document.querySelector(n.cartFooterButtonMessage);if(!e)return;const o=document.querySelector(n.additionalButtons),t=document.querySelector(n.cartButton),r=Number(e.getAttribute("data-cart-total")),c=e.getAttribute("data-amount-message"),a=e.getAttribute("data-success-message"),l=e.getAttribute("data-amount-cents")*x;if(r/l*100<100){const s=l-r,p=window.themeCore.utils.formatMoney(s,I);o&&o.classList.remove(u.hidden),e.classList.add(u.disabled),e.innerHTML=c.replace("{rest}",`<strong>${p}</strong>`),t.setAttribute("disabled","")}else o&&o.classList.add(u.hidden),e.classList.remove(u.disabled),e.innerHTML=a,t.removeAttribute("disabled")}function he(){new window.Shopify.CountryProvinceSelector("cart-address-country","cart-address-province",{hideElement:"cart-address-province-container"});const e=document.querySelector(".js-get-ship-rates"),o=document.querySelectorAll(".js-ship-rate-field"),t=document.getElementById("cart-address-country"),r=document.getElementById("cart-address-province"),c=document.getElementById("cart-address-zip"),a=document.getElementById("cart-rates-wrapper");let l={country:"",province:"",zip:""};o.forEach(function(s){let p="keyup";s.tagName==="SELECT"&&(p="change"),s.addEventListener(p,()=>{d(s)})}),e.addEventListener("click",function(s){s.preventDefault(),e.setAttribute("disabled",""),l.country=t.value||"",l.province=r.value||"",l.zip=c.value||"";const p=`shipping_address[country]=${l.country}&shipping_address[province]=${l.province}&shipping_address[zip]=${l.zip}`,m=encodeURI(`${p}`);try{fetch(`/cart/prepare_shipping_rates.json?${m}`,{method:"POST"}).then(g=>g.text()).then(g=>{const w=JSON.parse(g);if(typeof w=="object"&&w!==null){Object.entries(w).forEach(([f,E])=>{const y=document.getElementById(`cart-address-${f}`),i=document.getElementById(`error-cart-address-${f}`);i&&(i.textContent=`${E}`,i.classList.remove(u.hidden),y.setAttribute("aria_invalid","true"),y.setAttribute("aria_describedby",`error-cart-address-${f}`))}),e.removeAttribute("disabled");return}fetch(`/cart/async_shipping_rates.json?${m}`).then(f=>f.text()).then(f=>{const E=JSON.parse(f),y=E?E.shipping_rates:[];if(e.removeAttribute("disabled"),y.length>0){a.innerHTML="";const i=document.createElement("ul");i.classList.add("cart-shipping-calc__rate-list"),y.forEach(C=>{const b=document.createElement("li");i.appendChild(b);const L=C.name;let v=C.price;const z=C.delivery_days;let _="";v==="0.00"?v=window.themeCore.translations.get("cart.shipping_rates.price_free"):v=`${window.themeCore.utils.formatMoney(v.includes(".")?v:v+".00",window.themeCore.objects.shop.money_format)}`,z.length&&(z.forEach((V,we)=>{_=we===0?V:`${_}-${V}`}),_=`<span>${_} days</span>`),b.innerHTML=`<span class="cart-shipping-calc__rate-name">${L}:</span> ${_} ${v}`}),a.appendChild(i)}else a.innerHTML=window.themeCore.translations.get("cart.shipping_rates.no_shipping")})})}catch(g){console.log(g,"Error with shipping rates")}});function d(s){if(!s)return;const p=s.id.split("cart-address-")[1],m=document.getElementById(`error-cart-address-${p}`);s.removeAttribute("aria_invalid"),s.removeAttribute("aria_describedby"),m&&(m.classList.add(u.hidden),m.textContent="")}}return Object.freeze({init:G})};export{ye as C};
