const me=l=>{const f={...window.themeCore.utils.cssClasses,searchWithSideBar:"search--with-sidebar"},Y=window.themeCore.utils.Toggle,C=window.themeCore.utils.overlay,g={form:".js-form",emptyTitle:".js-template-empty-title",gridWrapper:".js-grid-wrapper",searchSideBar:".js-search-sidebar",filterMenuOpenerWrapper:".js-filter-menu-opener-wrapper",filterMenuOpener:".js-filter-menu-opener",activeFiltersCounter:".js-active-filters-counter",selectedFiltersWrapper:".js-selected-filters-wrapper",filtersContainer:".js-filters-container",filterAccordionItem:".js-accordion-filter-item",filterLists:".js-filter-list",filterPrice:".js-filter-price",pagination:".js-pagination",loadMoreButton:".js-lazy-load",infiniteScroll:".js-infinite-scroll",filtersBody:".js-filters-body",search:".js-search"},L={maxInput:".js-price-input-max",minInput:".js-price-input-min",rangeInputs:".js-range-inputs",minRange:".js-price-range-min",maxRange:".js-price-range-max",priceProgress:".js-price-progress"},c={collectionHeader:".js-collection-header",filterMenuToggler:"filterMenuToggler",paginationLink:".js-pagination-link",priceNumberInput:".js-price-input",priceRangeInput:".js-price-range",removeFilterLink:".js-remove-filter",resetFilters:".js-reset-filters",cssRoot:":root",header:"[data-header-container]",pageLoader:".js-page-preloader",productFilters:".js-product-filters",searchTypes:".js-search-types",searchTypeActiveButton:"[data-search-type].is-active",...g,...L},a={fixed:"is-fixed",noEvents:"no-events",error:"is-error",...f},T={priceFrom:"filter.v.price.gte",priceTo:"filter.v.price.lte"},M={query:"q",type:"type",optionsPrefix:"options[prefix]"},P={page:"page",sort:"sort_by",...M},b={rangeMin:"--range-min",rangeMax:"--range-max",headerHeight:"--header-height",headerOffsetTop:"--header-offset-top"},z={extraSmall:"(max-width: 767px)"},y={extraSmallScreen:window.matchMedia(z.extraSmall),openMenuButtonObserver:null,infiniteScrollObserver:null,cssRoot:document.querySelector(c.cssRoot)},G=Y({toggleSelector:c.filterMenuToggler,closeAccordionsOnHide:!1,toggleTabIndex:!1});let i=p(l,g),j=window.location.href.split("#")[0];const w=document.querySelector(c.pageLoader);function p(e,t){const r={};return Object.entries(t).forEach(([n,s])=>{const o=[...e.querySelectorAll(s)];if(!o.length){r[n]=null;return}if(o.length>1){r[n]=o;return}r[n]=o[0]}),e!=null&&e.matches&&e.matches(t.search)&&(r.search=e),r}function J(){let e=R();e=0;const t={rootMargin:`-${e}px 0px 0px 0px`};y.openMenuButtonObserver=A(i.filterMenuOpenerWrapper,W,Q,t)}function R(){const e=y.cssRoot.style.getPropertyValue(b.headerHeight),t=y.cssRoot.style.getPropertyValue(b.headerOffsetTop);return parseInt(e)+parseInt(t)}function B(){y.infiniteScrollObserver=A(i.infiniteScroll,()=>de(y.infiniteScrollObserver,i.infiniteScroll))}function A(e,t,r,n={}){const s=new IntersectionObserver(o=>{o.forEach(d=>{d.isIntersecting?typeof t=="function"&&t():typeof r=="function"&&r()})},n);return s.observe(e),s}function W(){i.filterMenuOpener&&(i.filterMenuOpener.classList.remove(a.fixed),i.filterMenuOpenerWrapper.style.minHeight="auto")}function Q(){!i.filterMenuOpener||X(i.filterMenuOpenerWrapper)||(i.filterMenuOpenerWrapper.style.minHeight=`${i.filterMenuOpenerWrapper.offsetHeight}px`,i.filterMenuOpener.classList.add(a.fixed))}function X(e){const t=R();return e.offsetTop+e.offsetHeight>=window.pageYOffset+t}async function Z(e){const t=e.target.closest(c.form);if(!t||te())return;const r=new FormData(t),n=[...r.keys()],{minInput:s,maxInput:o}=p(l,L);n.forEach(u=>{(u===T.priceFrom||u===T.priceTo)&&(u===T.priceFrom&&Number(s.value)===Number(s.min)||u===T.priceTo&&Number(o.value)===Number(o.max))&&r.delete(u)});const d=ee(r);t.classList.add(a.loading),window.parent===window.top&&window.history.pushState({},null,d),await v(d),t.classList.remove(a.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden")}function ee(e){const t=new URLSearchParams(e).toString(),r=new URL(window.location.href),n=new URL(`${window.location.origin}${window.location.pathname}?${t}`);for(const s in M){const o=r.searchParams.get(M[s]);o&&n.searchParams.set(M[s],o)}return n}function te(){return i.filterPrice?[...i.filterPrice.querySelectorAll(c.priceNumberInput)].some(t=>t.classList.contains(a.error)):!1}async function v(e){i.gridWrapper.ariaBusy="true";const t=q(e,l.id),r=await k(t),n=p(r,g);re(n),window.themeCore.LazyLoadImages.init(),i.gridWrapper.ariaBusy="false",window.themeCore.EventBus.emit("compare-products:init"),j=window.location.href.split("#")[0]}function q(e,t=l.id){const r=new URL(e);return r.searchParams.set("section_id",t),r.toString()}async function k(e){const r=await(await fetch(e)).text();return new DOMParser().parseFromString(r,"text/html")}function re(e){if(!e||!Object.keys(e).length)return;const{selectedFiltersWrapper:t,gridWrapper:r,filterMenuOpener:n,activeFiltersCounter:s,filterAccordionItem:o,filterPrice:d,pagination:u,loadMoreButton:x,infiniteScroll:$,filtersBody:F,searchSideBar:V,search:D}=e;D&&i.search&&i.search.classList.toggle(f.searchWithSideBar,D.classList.contains(f.searchWithSideBar)),V&&i.searchSideBar&&i.searchSideBar.classList.toggle(f.hidden,V.classList.contains(f.hidden));const O=document.querySelector(c.productFilters);if(O&&t&&!i.selectedFiltersWrapper&&(i.filtersBody.innerHTML=F.innerHTML,O.classList.remove(f.hidden),i=p(l,g),window.themeCore.Accordion.init(),d&&S()),O&&i.selectedFiltersWrapper&&!t&&F&&(i.filtersBody.innerHTML=F.innerHTML,O.classList.add(f.hidden),i=p(l,g)),i.gridWrapper.innerHTML=r.innerHTML,r.innerHTML?(i.gridWrapper.classList.remove(a.hidden),i.emptyTitle.classList.add(a.hidden),i.emptyTitle.ariaHidden="true"):(i.gridWrapper.classList.add(a.hidden),i.emptyTitle.classList.remove(a.hidden),i.emptyTitle.ariaHidden="false"),i.filtersContainer){const m=i.filtersContainer.querySelectorAll(c.filterAccordionItem);Array.from(m).forEach(h=>{o&&Array.from(o).length===0?h.id!==o.id&&h.remove():Array.from(o).some(({id:E})=>h.id===E)||h.remove()})}o&&o.length&&o.forEach((m,h)=>{const E=document.getElementById(m.id);if(E){const I=E.querySelector(c.filterLists),H=m.querySelector(c.filterLists);if(!I||!H)return;I.innerHTML=H.innerHTML}else{if(h>0){const H=o[h-1].id;document.getElementById(H).after(m);return}m.parentElement&&i.filtersContainer.querySelector(c.filterAccordionItem).before(m)}}),window.themeCore.Accordion.init(".js-filters-container"),i.filterMenuOpener.dataset.count=n?n.dataset.count:0,U({activeFiltersCounter:s,filterPrice:d,pagination:u,selectedFiltersWrapper:t,infiniteScroll:$,loadMoreButton:x}),$&&B(),d&&S()}function S(){const{minInput:e,maxInput:t,rangeInputs:r}=p(l,L),{thumbOffset:n}=r.dataset,s=`calc(${Number(e.value)/Number(e.max)*100}% - ${n}px)`,o=`calc(${Number(t.value)/Number(t.max)*100}% + ${n}px)`;r.style.setProperty(b.rangeMin,s),r.style.setProperty(b.rangeMax,o)}function U(e){var t,r;if(!(!e||!Object.keys(e).length)){for(const n in e)if(i[n]&&(i[n].classList.remove(...i[n].classList),i[n].classList.add(...((t=e[n])==null?void 0:t.classList)||[]),i[n].innerHTML=((r=e[n])==null?void 0:r.innerHTML)||"",e[n]))for(const s in e[n].dataset)i[n].dataset[s]=e[n].dataset[s]}}async function ne(e){const t=e.target.closest(c.paginationLink);if(!t)return;e.preventDefault(),w.classList.add(a.active),t.classList.add(a.noEvents),W();let r=se();const n=new URL(t.href).searchParams.get("type");window.scrollTo(0,r),window.parent===window.top&&window.history.pushState({},null,t.href),await v(t.href),w.classList.remove(a.active);const s=document.querySelector(c.searchTypes),o=document.querySelector(c.searchTypeActiveButton);if(!s||!o)return;s.value=n;let d=document.querySelectorAll(".js-search-types-wrapper .js-pagination-link");d.length&&d.forEach(x=>{x.classList.toggle(f.active,x.getAttribute("data-search-type")===n)});const u=document.querySelector(c.gridWrapper);u&&u.setAttribute("data-type",n)}async function ie(){const e=window.location.href.split("#")[0];e!==j&&(j=e,C({namespace:"filters-template"}).open(),await v(window.location.href),C({namespace:"filters-template"}).close())}function se(){const t=document.querySelector(c.header).hasAttribute("data-header-sticky")?R():0,r=document.querySelector(c.collectionHeader);if(!r)return 0;const n=window.pageYOffset+r.getBoundingClientRect().top,s=t+10;return n-s}function oe(e){const t=e.target.closest(c.priceNumberInput);if(!t)return;const{minInput:r,maxInput:n,minRange:s,maxRange:o}=p(l,L),d=n.value&&r.value&&Number(n.value)<=Number(n.max)&&Number(r.value)>=Number(r.min);if(Number(n.value)-Number(r.value)>=0&&d){t.dataset.type==="min"?s.value=r.value:o.value=n.value,S(),_(r,n);return}t.dataset.type==="min"?r.classList.add(a.error):n.classList.add(a.error)}function ae(e){const t=e.target.closest(c.priceRangeInput);if(!t)return;const{minInput:r,maxInput:n,minRange:s,maxRange:o}=p(l,L);o.value-s.value<0&&(t.dataset.type==="min"?s.value=r.value:o.value=n.value),r.value=s.value,n.value=o.value,_(r,n),S()}function _(...e){e.forEach(t=>t.classList.remove(a.error))}async function ce(e){const t=e.target.closest(c.removeFilterLink);t&&(e.preventDefault(),i.form.classList.add(a.loading),window.parent===window.top&&window.history.pushState({},null,t.href),await v(t.href),i.form.classList.remove(a.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden"))}async function le(e){if(!e.target.closest(c.resetFilters))return;const r=new URL(window.location.href);[...r.searchParams.keys()].filter(s=>s!==P.sort&&s!==P.query).forEach(s=>r.searchParams.delete(s)),i.form.classList.add(a.loading),window.parent===window.top&&window.history.pushState({},null,r),await v(r),i.form.classList.remove(a.loading),window.themeCore.Accordion.setTabIndex(".product-filters__form-accordion","hidden")}async function de(e,t){e.unobserve(t);const r=window.location.origin+t.dataset.nextUrl;w.classList.add(a.active),await N(r),w.classList.remove(a.active)}async function N(e){const t=q(e,l.id),r=await k(t),{gridWrapper:n,infiniteScroll:s,loadMoreButton:o}=p(r,g);i.gridWrapper.insertAdjacentHTML("beforeend",n.innerHTML),U({infiniteScroll:s,loadMoreButton:o}),s&&B(),window.themeCore.LazyLoadImages.init(),window.themeCore.EventBus.emit("compare-products:init")}async function ue(e){const t=e.target.closest(c.loadMoreButton);if(!t)return;w.classList.add(a.active),t.classList.add(a.noEvents);const r=window.location.origin+t.dataset.nextUrl;await N(r),w.classList.remove(a.active)}function pe(e){const{filterMenuOpenerWrapper:t,loadMoreButton:r,infiniteScroll:n,filterLists:s,filterPrice:o,pagination:d,form:u}=e;t&&(G.init(),J()),(s||o)&&l.addEventListener("click",ce),o&&S(),l.addEventListener("input",oe),l.addEventListener("input",ae),(d||u)&&window.addEventListener("popstate",ie),u&&l.addEventListener("change",Z),s&&l.addEventListener("click",le),(d||l.querySelector(c.paginationLink))&&l.addEventListener("click",ne),r&&l.addEventListener("click",ue),n&&B()}function fe(){!l||!Object.keys(i).length||pe(i)}return Object.freeze({init:fe})},K=()=>{window.themeCore.utils.registerExternalUtil(me,"ProductFilters")};window.themeCore&&window.themeCore.loaded?K():document.addEventListener("theme:all:loaded",K,{once:!0});
