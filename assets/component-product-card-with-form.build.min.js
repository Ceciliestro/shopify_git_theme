const o={card:".js-product-card",form:".js-product-card-form",imageWrapper:".js-product-card-form-images-wrapper",price:".js-price",button:".js-product-card-button",product:".js-product-card-product",variantElemJSON:"[data-selected-variant]",option:"select[data-option], [data-option]:checked",hiddenInput:".js-product-card-variant-input",swatches:"[data-option-index]",formError:".js-product-card-error",checkmark:".js-product-card-checkmark",minQuantity:".js-product-card-min-value"},V=()=>{const l=window.themeCore.utils.cssClasses;function C(){v()}function v(){document.addEventListener("change",E),document.addEventListener("submit",P)}async function E(t){const e=t.target.closest(o.form);if(!e)return;const r=e.closest(o.card);if(!r)return;const n=r.dataset.section,a=[...r.querySelectorAll(o.imageWrapper)],i=e.querySelector(o.swatches),c=i&&i.dataset.optionIndex;let s=[...e.querySelectorAll(o.option)];const h=r.querySelector(o.price);let p=e.querySelector(o.button);p&&p.classList.contains(l.hidden)&&(p=null);const w=q(e.querySelector(o.product)),g=r.querySelector(o.checkmark),j=e.querySelector(o.formError);if(!w||(t.target.tagName==="SELECT"&&t.target.selectedOptions.length&&(Array.from(t.target.options).find(u=>u.getAttribute("selected")).removeAttribute("selected"),t.target.selectedOptions[0].setAttribute("selected","selected")),!((!c||s.some(u=>u.name===c))&&s.every(u=>u.value))))return;g&&g.classList.add(l.active);const y=e.querySelector(o.hiddenInput),I=r.getAttribute("data-product-url");await L(e,I);const d=T(e);d?(m(d.id,y),A(d.featured_image,a),await O(w.handle,d.id,h)):(m("",y),k(h)),b(d,p||j,r),window.themeCore.EventBus.emit("product-card:change-variant",{sectionId:n})}function q(t){try{return JSON.parse(t.textContent)}catch{return null}}async function L(t,e){if(!t||!e)return;const r=Array.from(t.querySelectorAll("select[data-option] option[selected], input[data-option]:checked")).map(({dataset:s})=>s.optionValueId),n=r.length>0?`&option_values=${r.join(",")}`:"",a=`${e}?section_id=product-bundle-card${n}`,i=await f(a,o.variantElemJSON),c=t.querySelector(o.variantElemJSON);c&&(c.innerHTML=i.innerHTML)}function T(t){if(!t)return;const e=t.querySelector(o.variantElemJSON);return e?JSON.parse(e.innerHTML):null}function m(t,e){e&&(e.value=t)}function A(t,e){if(!t)return;e.some(n=>n.dataset.imageId.includes(String(t.id)))&&e.forEach(n=>{n.dataset.imageId.includes(String(t.id))?n.classList.add(l.active):n.classList.remove(l.active)})}async function O(t,e,r){if(!r)return;const n=M(t,e,"price").toString();if(!n)return;const a=await f(n,o.fetchPrice);r.innerHTML=a.querySelector(o.price)&&a.querySelector(o.price).outerHTML}async function f(t,e){try{const n=await(await fetch(t)).text();let a=new DOMParser().parseFromString(n,"text/html");return e&&(a=a.querySelector(e)),a}catch(r){console.error(r)}}function b(t,e,r){if(!e)return;const n=!e.matches(o.button),a=r.hasAttribute("data-preorder");t?t.available?a?e.innerHTML=window.themeCore.translations.get("products.product.pre_order"):n?e.innerHTML="":e.innerHTML=window.themeCore.translations.get("products.product.add_to_cart"):e.innerHTML=window.themeCore.translations.get("products.product.sold_out"):e.innerHTML=window.themeCore.translations.get("products.product.unavailable"),!n&&(e.disabled=!t||!t.available)}function M(t,e,r){if(!t)return;const n=window.Shopify.routes.root,a=new URL(`${window.location.origin}${n}products/${t}`);return a.searchParams.set("view",r),e&&a.searchParams.set("variant",e),a}function k(t){t&&(t.innerHTML="")}async function P(t){const e=t.target.closest(o.form),r=e&&new FormData(e),n=e&&e.querySelector(o.hiddenInput),a=e&&e.querySelector(o.minQuantity),i=n&&n.value,c=a?Number(a.value):1;if(!r||!i)return;t.preventDefault();const s=await H(i,c);N(e,s),s&&window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.GET_CART)}async function H(t,e){const r=document.querySelector(o.card);try{const n={id:t,quantity:Number(e)};r&&r.hasAttribute("data-preorder")&&(n.properties=n.properties||{},n.properties["_Pre-order"]="true"),await window.themeCore.CartApi.makeRequest(window.themeCore.CartApi.actions.ADD_TO_CART,n)}catch(n){return n.description}}function N(t,e=""){const r=t&&t.querySelector(o.formError);r&&(r.innerText=e)}return Object.freeze({init:C})},S=()=>{window.themeCore.ProductCardWithForm=window.themeCore.ProductCardWithForm||V(),window.themeCore.utils.register(window.themeCore.ProductCardWithForm,"product-card-with-banner")};window.themeCore&&window.themeCore.loaded?S():document.addEventListener("theme:all:loaded",S,{once:!0});
